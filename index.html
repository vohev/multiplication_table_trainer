<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢—Ä–µ–Ω–∞–∂—ë—Ä –¢–∞–±–ª–∏—Ü—ã</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --pink: #ffb7d5;
  --mint: #9ff5e4;
  --orange: #ffd599;
  --text: #92415a;
  --bg: #fff3fb;
  --error-bg: #ffd6d6;
}

/* GLOBAL */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Nunito", sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

/* ---------- BACKGROUND FLOATING CIRCLES ---------- */
.bg-circle {
  position: fixed;
  border-radius: 50%;
  opacity: 0.8;
  filter: blur(12px);
  z-index: -1;
  animation: float 18s infinite ease-in-out;
}

@keyframes float {
  0%   { transform: translateY(0); }
  50%  { transform: translateY(-40px); }
  100% { transform: translateY(0); }
}

.c1 { width: 260px; height: 260px; top: -60px; left: -40px; background: var(--mint); animation-delay: 0s; }
.c2 { width: 330px; height: 330px; bottom: -80px; right: -60px; background: var(--pink); animation-delay: 4s; }
.c3 { width: 200px; height: 200px; top: 40%; left: 10%; background: var(--orange); animation-delay: 8s; }
.c4 { width: 230px; height: 230px; top: 15%; right: -50px; background: var(--mint); animation-delay: 2s; }
.c5 { width: 300px; height: 300px; bottom: 10%; left: -70px; background: var(--pink); animation-delay: 6s; }
.c6 { width: 170px; height: 170px; top: 70%; left: 60%; background: var(--orange); animation-delay: 10s; }
.c7 { width: 230px; height: 230px; top: -30px; right: 30%; background: var(--mint); animation-delay: 12s; }
.c8 { width: 270px; height: 270px; bottom: -40px; right: 25%; background: var(--pink); animation-delay: 14s; }
.c9 { width: 190px; height: 190px; top: 55%; right: 10%; background: var(--orange); animation-delay: 16s; }
.c10{ width: 250px; height: 250px; top: 22%; left: 40%; background: var(--mint); animation-delay: 18s; }

/* APP LAYOUT */
#app {
  max-width: 520px;
  width: 100%;
  padding: 20px;
}

.screen {
  display: none;
  flex-direction: column;
  gap: 20px;
  animation: fade 0.3s ease;
}

@keyframes fade {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

.screen.active { display: flex; }

/* GRID OF NUMBERS */
.grid {
  display: grid;
  grid-template-columns: repeat(3,1fr);
  justify-items: center;
  justify-content: center;
  gap: 16px;
  max-width: 340px;
  margin: 0 auto;
}

.card {
  background: #fff;
  padding: 24px;
  border-radius: 22px;
  width: 90px;
  text-align: center;
  font-size: 2rem;
  cursor: pointer;
  box-shadow: 0 10px 26px rgba(0,0,0,0.12);
  transition: 0.25s;
}

.card:hover { transform: translateY(-4px) scale(1.03); }

/* MODES BUTTONS */
.mode {
  padding: 20px;
  border-radius: 26px;
  font-size: 1.4rem;
  text-align: center;
  cursor: pointer;
  box-shadow: 0 10px 26px rgba(0,0,0,0.12);
  transition: 0.25s;
}

.mode:nth-child(1) { background: var(--pink); }
.mode:nth-child(2) { background: var(--mint); }
.mode:nth-child(3) { background: var(--orange); }

.mode:hover {
  transform: translateY(-3px);
  box-shadow: 0 14px 30px rgba(0,0,0,0.16);
}

/* GAME AREA */
#lives { text-align: center; font-size: 1.9rem; }

#progress {
  display: flex;
  justify-content: center;
  gap: 6px;
}

.dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: rgba(255,255,255,0.7);
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.dot.active { background: var(--pink); }

/* TIMER */
#timerWrapper {
  display: flex;
  justify-content: center;
}

#timerCircle {
  position: relative;
  width: 80px;
  height: 80px;
}

#timerCircle svg { width: 100%; height: 100%; transform: rotate(-90deg); }

#timerCircle circle {
  stroke: var(--pink);
  stroke-width: 6;
  fill: none;
  stroke-linecap: round;
  transition: 0.3s;
}

#timerCircle.error circle {
  stroke: #ff1a1a !important;
  filter: drop-shadow(0 0 6px rgba(255,0,0,0.6));
}

#timerInside {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/* GAME CARD */
#gameCard {
  background: #fff;
  padding: 24px;
  border-radius: 22px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.16);
  transition: 0.25s ease;
}

#gameCard.error {
  background: #ffe4e4 !important;
  border: 3px solid #ff4a4a !important;
  box-shadow: 0 0 22px rgba(255, 0, 0, 0.55);
  animation: shake 0.35s;
}

@keyframes shake {
  0% { transform: translateX(0); }
  25%{ transform: translateX(-5px); }
  50%{ transform: translateX(5px); }
  75%{ transform: translateX(-3px); }
 100%{ transform: translateX(0); }
}

#problem {
  text-align: center;
  font-size: 2.4rem;
}

/* ANSWER */
#answerRow {
  display: flex;
  justify-content: center;
  gap: 10px;
}

#answer {
  width: 140px;
  font-size: 2rem;
  text-align: center;
  border-radius: 16px;
  border: 3px solid var(--pink);
  padding: 6px 12px;
}

#message {
  text-align: center;
  min-height: 28px;
}

#message.error {
  color: #cc0000 !important;
  font-weight: bold;
  text-shadow: 0 0 4px rgba(255,0,0,0.3);
}

/* BUTTON BEAUTY */
button {
  background: var(--pink);
  padding: 12px 26px;
  border-radius: 20px;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: var(--text);
  transition: 0.25s;
  box-shadow: 0 6px 16px rgba(0,0,0,0.12);
  width: auto;
  margin: 0 auto;
  display: block;
}

button:hover {
  background: var(--mint);
  transform: translateY(-2px);
}

/* SUBSCRIBE */
#subscribe {
  position: fixed;
  right: 18px;
  bottom: 20px;
  background: var(--orange);
  padding: 14px 20px;
  border-radius: 40px;
  cursor: pointer;
}

#fireworks { position: fixed; inset:0; pointer-events:none; }

@keyframes boom {
  0%   { opacity: 1; transform: scale(0); }
  80%  { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.3); }
}
</style>
</head>

<body>

<!-- Background circles -->
<div class="bg-circle c1"></div><div class="bg-circle c2"></div><div class="bg-circle c3"></div><div class="bg-circle c4"></div><div class="bg-circle c5"></div><div class="bg-circle c6"></div><div class="bg-circle c7"></div><div class="bg-circle c8"></div><div class="bg-circle c9"></div><div class="bg-circle c10"></div>

<div id="app">

  <!-- Screen 1 -->
  <div id="screenNumbers" class="screen active">
    <h2 style="text-align:center;">–í—ã–±–µ—Ä–∏ —Ç–∞–±–ª–∏—Ü—É</h2>
    <div class="grid">
      <div class="card" data-num="2">2</div>
      <div class="card" data-num="3">3</div>
      <div class="card" data-num="4">4</div>
      <div class="card" data-num="5">5</div>
      <div class="card" data-num="6">6</div>
      <div class="card" data-num="7">7</div>
      <div class="card" data-num="8">8</div>
      <div class="card" data-num="9">9</div>
      <div class="card" data-num="all">–í—Å–µ</div>
    </div>
  </div>

  <!-- Screen 2 -->
  <div id="screenMode" class="screen">
    <h2 style="text-align:center;">–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º</h2>
    <div class="mode" data-mode="mul">–£–º–Ω–æ–∂–µ–Ω–∏–µ ‚úñ</div>
    <div class="mode" data-mode="div">–î–µ–ª–µ–Ω–∏–µ ‚ûó</div>
    <div class="mode" data-mode="mix">–í—Å—ë –≤–º–µ—Å—Ç–µ ‚àû</div>
  </div>

  <!-- Screen 3 -->
  <div id="screenGame" class="screen">
    <div id="lives"></div>

    <div id="timerWrapper">
      <div id="timerCircle">
        <svg viewBox="0 0 80 80"><circle cx="40" cy="40" r="34"></circle></svg>
        <div id="timerInside">‚è∞<br><span id="timerText">15</span></div>
      </div>
    </div>

    <div id="progress"></div>

    <div id="gameCard">
      <div id="problem"></div>
      <div id="answerRow">
        <input id="answer" type="number" />
        <button id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>
      <p id="message"></p>
    </div>
  </div>

  <!-- WIN -->
  <div id="winScreen" class="screen">
    <h1 style="text-align:center;">üéâ –û—Ç–ª–∏—á–Ω–æ!</h1>
    <p style="text-align:center;">–¢—ã –ø—Ä–æ—à—ë–ª —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É üíñ</p>
    <button onclick="location.reload()">–ï—â—ë —Ä–∞–∑</button>
  </div>

  <!-- LOSE -->
  <div id="loseScreen" class="screen">
    <h1 style="text-align:center;">üòå –û—à–∏–±–∫–∞ ‚Äî —ç—Ç–æ –æ–ø—ã—Ç!</h1>
    <p style="text-align:center;">–ü–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑ ü´∂</p>
    <button onclick="location.reload()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  </div>

</div>

<div id="fireworks"></div>

<div id="subscribe" onclick="window.open('https://t.me/yuliya_matematika','_blank')">üíå @yuliya_matematik</div>

<!--  JS –±—É–¥–µ—Ç –≤–æ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏  -->
<script>
/* -------------------- SELECTORS -------------------- */
const screenNumbers = document.getElementById("screenNumbers");
const screenMode = document.getElementById("screenMode");
const screenGame = document.getElementById("screenGame");
const winScreen = document.getElementById("winScreen");
const loseScreen = document.getElementById("loseScreen");

const livesEl = document.getElementById("lives");
const progressEl = document.getElementById("progress");
const problemEl = document.getElementById("problem");
const answerInput = document.getElementById("answer");
const checkBtn = document.getElementById("checkBtn");
const messageEl = document.getElementById("message");

const timerText = document.getElementById("timerText");
const timerCircleEl = document.querySelector("#timerCircle circle");
const timerCircle = document.getElementById("timerCircle");

const gameCard = document.getElementById("gameCard");
const fireworksEl = document.getElementById("fireworks");

/* -------------------- GAME STATE -------------------- */
let selectedNumber = null;
let selectedMode = null;
let tasks = [];
let currentIndex = 0;
let lives = 3;
let timer = 15;
let intervalId = null;

/* -------------------- SCREEN SWITCH -------------------- */
function show(screen) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  screen.classList.add("active");
}

/* -------------------- SELECT NUMBER -------------------- */
screenNumbers.querySelectorAll(".card").forEach(card => {
  card.addEventListener("click", () => {
    selectedNumber = card.dataset.num;
    show(screenMode);
  });
});

/* -------------------- SELECT MODE -------------------- */
screenMode.querySelectorAll(".mode").forEach(btn => {
  btn.addEventListener("click", () => {
    selectedMode = btn.dataset.mode;
    startGame();
  });
});

/* -------------------- GENERATE TASKS -------------------- */
function generateAllTasks() {
  const arr = [];
  const bases = selectedNumber === "all"
    ? [2,3,4,5,6,7,8,9]
    : [Number(selectedNumber)];

  for (let a of bases) {
    for (let b = 1; b <= 9; b++) {

      if (selectedMode === "mul") {
        arr.push({ text: `${a} √ó ${b}`, ans: a * b });
      }

      else if (selectedMode === "div") {
        arr.push({ text: `${a*b} √∑ ${a}`, ans: b });
      }

      else if (selectedMode === "mix") {
        arr.push({ text: `${a} √ó ${b}`, ans: a*b });
        arr.push({ text: `${a*b} √∑ ${a}`, ans: b });
      }

    }
  }

  return arr;
}

function shuffle(a) {
  const arr = [...a];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* -------------------- START GAME -------------------- */
function startGame() {
  const all = shuffle(generateAllTasks());
  tasks = all.slice(0, Math.min(10, all.length));

  currentIndex = 0;
  lives = 3;

  renderLives();
  renderProgress();
  show(screenGame);
  nextTask();
}

/* -------------------- RENDER -------------------- */
function renderLives() {
  livesEl.textContent = "‚ù§Ô∏è".repeat(lives);
}

function renderProgress() {
  progressEl.innerHTML = "";
  for (let i = 0; i < tasks.length; i++) {
    const dot = document.createElement("div");
    dot.className = "dot" + (i < currentIndex ? " active" : "");
    progressEl.appendChild(dot);
  }
}

/* -------------------- TASK FLOW -------------------- */
function nextTask() {
  messageEl.textContent = "";
  messageEl.classList.remove("error");

  if (currentIndex >= tasks.length) {
    win();
    return;
  }

  timer = 15;
  updateTimerVisual();

  const task = tasks[currentIndex];
  problemEl.textContent = task.text + " =";

  answerInput.value = "";
  answerInput.focus();

  clearInterval(intervalId);
  intervalId = setInterval(() => {
    timer--;
    updateTimerVisual();

    if (timer <= 0) {
      clearInterval(intervalId);
      showError("–í—Ä–µ–º—è –≤—ã—à–ª–æ!");
      loseLife();
    }
  }, 1000);
}

/* -------------------- TIMER -------------------- */
function updateTimerVisual() {
  const r = 34;
  const c = 2 * Math.PI * r;

  timerText.textContent = timer;

  timerCircleEl.style.strokeDasharray = c;
  timerCircleEl.style.strokeDashoffset = c * (1 - timer / 15);

  if (timer <= 5) {
    timerCircle.classList.add("pulse");
    timerCircleEl.style.stroke = "#ff4a4a";
  } else {
    timerCircle.classList.remove("pulse");
    timerCircleEl.style.stroke = "var(--pink)";
  }
}

/* -------------------- CHECK ANSWER -------------------- */
checkBtn.addEventListener("click", checkAnswer);
answerInput.addEventListener("keydown", e => {
  if (e.key === "Enter") checkAnswer();
});

function checkAnswer() {
  if (!answerInput.value.trim()) return;

  const val = Number(answerInput.value);
  const correct = tasks[currentIndex].ans;

  if (val === correct) {
    messageEl.textContent = "–í–µ—Ä–Ω–æ! ‚ú®";
    currentIndex++;
    renderProgress();
    nextTask();
  } else {
    showError(`–ù–µ–≤–µ—Ä–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct}`);
    loseLife();
  }
}

/* -------------------- ERROR EFFECT -------------------- */
function showError(text) {
  messageEl.textContent = text;
  messageEl.classList.add("error");

  gameCard.classList.add("error");
  timerCircle.classList.add("error");

  setTimeout(() => {
    gameCard.classList.remove("error");
    timerCircle.classList.remove("error");
  }, 600);
}

/* -------------------- LOSE LIFE -------------------- */
function loseLife() {
  lives--;
  renderLives();

  if (lives <= 0) {
    clearInterval(intervalId);
    show(loseScreen);
    return;
  }

  currentIndex++;
  renderProgress();
  nextTask();
}

/* -------------------- WIN -------------------- */
function win() {
  clearInterval(intervalId);
  launchFireworks();
  show(winScreen);
}

/* -------------------- FIREWORKS -------------------- */
function launchFireworks() {
  fireworksEl.innerHTML = "";

  const colors = ["var(--pink)", "var(--mint)", "var(--orange)"];

  for (let i = 0; i < 45; i++) {
    const p = document.createElement("div");
    const size = Math.random() * 12 + 6;

    p.style.position = "absolute";
    p.style.width = size + "px";
    p.style.height = size + "px";
    p.style.background = colors[Math.floor(Math.random() * colors.length)];
    p.style.borderRadius = "50%";
    p.style.left = Math.random() * 100 + "%";
    p.style.top = (Math.random() * 40 + 30) + "%";
    p.style.animation = "boom 1s ease-out forwards";

    fireworksEl.appendChild(p);
  }
}
</script>
